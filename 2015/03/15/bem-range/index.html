<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Как я БЭМ-компонент писал | ~kuflash~</title>
  <meta name="title" content="Как я БЭМ-компонент писал" />
  <meta name="description" content="Мысли о веб-разработке и не только" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="/" />
  <meta name="twitter:title" content="Как я БЭМ-компонент писал" />
  <meta name="twitter:description" content="Мысли о веб-разработке и не только" />
  <meta name="twitter:image" content="/pictures/bg-blog.jpg" />
  <meta name="twitter:url" content="http://www.kuflash.ru/2015/03/15/bem-range/" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="image_src" href="/pictures/bg-blog.jpg" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />

  <meta name="generator" content="~kuflash~">

  
  
  

  
</head>


<body class="post-template">

  <header class="site-head"  style="background-image: url(/pictures/bg-blog.jpg)" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/pictures/ava.png" alt="Blog Logo"/></a> 
            <h1 class="blog-title">~kuflash~</h1>
            <h2 class="blog-description">Мысли о веб-разработке и не только</h2>
        </div>
    </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2015-03-15T11:58:58.000Z" itemprop="datePublished">
          15 марта 2015
      </time>
    
</span>
    <h1 class="post-title">Как я БЭМ-компонент писал</h1>
    <section class="post-content">
      <p>28 января 2015 года ребята из <a href="http://loftblog.ru/" target="_blank" rel="external">LoftBlog</a> совместно с компанией Яндекс провели <a href="https://ru.bem.info/talks/loftschool-music-2015/" target="_blank" rel="external">вебинар</a>, где рассказали и показали, как использовать БЭМ-стек в своих проектах. В конце мероприятия <a href="https://events.yandex.ru/lib/people/610400/" target="_blank" rel="external">Николай Ильченко</a> объявил о старте конкурса, в рамках которого, используя БЭМ-стек технологий, необходимо было разработать проект (статическая HTML страница, веб-приложение, библиотека блоков и т.п.). Тут я для себя и решил, что пора попробовать полный БЭМ-стек на вкус. До этого приходилось использовать только способ именования CSS классов.</p>
<h2 id="Выбор_темы">Выбор темы</h2><p>Я долго не мог определиться с темой, но, однажды в твиттере, наткнулся на <a href="https://twitter.com/webstandards_ru/status/565465353128783873" target="_blank" rel="external">ссылку</a> с примерами стилизации HTML 5 слайдера <code>&lt;input type=”range”&gt;</code>. Вдохновившись этими примерами было решено, что стоит написать такой компонент используя БЭМ-стек.</p>
<h2 id="Стартуем!">Стартуем!</h2><p>Для начала я стал изучать устройство библиотеки <a href="https://ru.bem.info/libs/bem-components/v2.0.0/" target="_blank" rel="external">bem-components</a>, чтобы понять как оформлять код будущего блока. Оказалось, что библиотека -  это просто набор блоков со стандартной организацией файлов и каталогов. А раз так, то можно спокойно приступать к работе.</p>
<p>Перво-наперво я установил yoman генератор <a href="https://ru.bem.info/tools/bem/bem-stub/" target="_blank" rel="external">generator-bem-stub</a>, для создания заготовки проекта. Это идеальный способ для старта разработки проекта на БЭМ-стеке. При запуске генератора  вам предложат выбрать технологи, которые буду использоваться при разработке. Я не буду описывать подробности работы данного генератора. Необходимую информацию вы найдете по этой <a href="https://ru.bem.info/tools/bem/bem-stub/" target="_blank" rel="external">ссылке</a>.</p>
<p>Запустить проект можно командой <code>enb server</code></p>
<h2 id="Структура_блока">Структура блока</h2><p>Далее необходимо было представить компонент в терминах БЭМ-методологии. Получилось следующее:</p>
<ul>
<li>блок <strong>range</strong> - основа блока;<ul>
<li>модификатор <strong>theme</strong> - служит для изменения внешнего вида слайдера;</li>
<li>элемент <strong>title</strong> - заголовок слайдера;</li>
<li>элемент <strong>box</strong> - необходим для группировки слайдера с элементом для отображения текущего значения;</li>
<li>элемент <strong>control</strong> - представление тега <code>&lt;input type=”range”&gt;</code>;</li>
<li>элемент <strong>value</strong> - необходим для отображения текущего значения слайдера;<ul>
<li>модификатор <strong>type</strong>- служит для определения поведения элемента. Имеет два состояния:<ul>
<li><strong>static</strong> - просто статичное отображение значения;</li>
<li><strong>tooltip</strong> - при изменении значения слайдера появляется под курсором мышки.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>На самом деле это окончательный вариант структуры. До него я несколько раз все менял. Сказывается неопытность в выделении сущностей согласно БЭМ-методологии.</p>
<h2 id="Стили">Стили</h2><p>После создания структуры блока я принялся писать стили для слайдера. В качестве препроцессора в стандартной комплектации БЭМ-проекта предоставляется Stylus. Опыта работы с ним не было, но у меня есть небольшой опыт использования Less, поэтому я быстро втянулся. Даже если вы не пользовались препроцессорами, то не пугайтесь, Stylus поддерживает обычный CSS синтаксис.</p>
<p>Для начала стили для блока <strong>range</strong>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.range</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line"><span class="rule">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>Все. Этого достаточно. Большая часть стилей будет как раз для компонента <code>&lt;input type=”range”&gt;</code>.</p>
<p>Далее идут элементы. Первым будет <strong>title</strong> - заголовок/лэйбл слайдера:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.range__title</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> middle</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">margin-right</span>:<span class="value"> <span class="number">10px</span></span></span>;</span><br><span class="line"><span class="rule">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>Следующий элемент <strong>box</strong> - обертка для тега input и элемента со значением слайдера:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.range__box</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line"><span class="rule">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>Элемент <strong>value</strong> - необходим для отображения выбранного значения слайдера:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.range__value</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> middle</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">margin-left</span>:<span class="value"> <span class="number">10px</span></span></span>;</span><br><span class="line"><span class="rule">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>Ну и напоследок самое вкусное)) Стили для элемента <strong>control</strong>, который является тегом <code>&lt;input type=”range”&gt;</code>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.range__control</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> middle</span></span>;</span><br><span class="line"><span class="rule">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>Вы наверное сейчас удивились. Что тут интересного?? Где стили для внешнего вида слайдера??</p>
<p>На самом деле вся кастомизация находится в модификаторе <strong>theme</strong>. Это создано для того, чтобы по умолчанию слайдер имел стандартный системный вид. А уж если разработчик захочет изменить внешний вид, то он просто создаст новую тему, или воспользуется уже поставляемой в библиотеке. Сейчас я все опишу.</p>
<p>В стилизации HTML 5 слайдера мне помогли примеры <a href="https://twitter.com/anatudor" target="_blank" rel="external">Анны Тьюдор</a>. Она создает восхитительные <a href="http://codepen.io/collection/DgYaMj/" target="_blank" rel="external">примеры</a> по стилизации этого компонента. Для изменения внешнего вида слайдера используются <em>вендорные псевдоэлементы</em>. Каждый браузер имеет по два псевдоэелемента:</p>
<ul>
<li>псевдоэлемент для стилей “трека” (линии), по которому двигается “бегунок”;</li>
<li>псевдоэлемент для стилей “бегунка”.</li>
</ul>
<p>Исключением является IE (да, да, опять IE). Но в этот раз он опередил своих товарищей. Помимо перечисленных выше, у него есть два дополнительных псевдоэлемента:</p>
<ul>
<li>псевдоэлемент для стилей выбранного промежутка;</li>
<li>псевдоэлемент для стилей не выбранного промежутка.</li>
</ul>
<p>Данную функциональность у других браузеров приходится реализовывать с помощью JavaScript. Способ состоит в том, чтобы динамически изменять свойство <code>background-size</code> у псевдоэлемента для “трека”, путем добавления стилей в тег <code>&lt;style&gt;</code> на странице. К сожалению другого способа я не нашел.</p>
<p><a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/_theme/range_theme_islands.styl" target="_blank" rel="external">Вот</a> пример стилей для темы <strong>Islands</strong>.</p>
<h2 id="JavaScript">JavaScript</h2><p>После написания стилей я приступил к реализации блока в JavaScript технологии. В БЭМ-стеке имеется фреймворк <a href="https://ru.bem.info/technology/i-bem/v2/i-bem-js/" target="_blank" rel="external">i-bem.js</a>, который предоставляет удобное API для работы с блоками в БЭМ-терминах. Весь код я расположил в одном файле <a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/range.js" target="_blank" rel="external">range.js</a> в корневом каталоге. Большая его часть относится как раз к реализации заливки выбранного диапазона. Сейчас я опишу все по порядку.</p>
<p>Во первых, делаем обертку модуля нашего блока:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">modules.define(<span class="string">'range'</span>, [<span class="string">'i-bem__dom'</span>, <span class="string">'jquery'</span>], <span class="function"><span class="keyword">function</span> <span class="params">(provide, BEMDOM, $)</span> </span>&#123;</span><br><span class="line">  provide(BEMDOM.decl(<span class="keyword">this</span>.name,</span><br><span class="line">    &#123; <span class="comment">/* методы экземпляра блока */</span> &#125;,</span><br><span class="line">    &#123; <span class="comment">/* статические методы блока */</span> &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Тут мы определяем название блока и его зависимости. Наш слайдер будет зависеть от элемента dom блока i-bem, т.к. слайдер имеет DOM представление. А также нужен jquery, для работы с DOM деревом.</p>
<p>Далее напишем что должно происходить при инициализации блока (эта часть описывается в области для методов экземпляра блока):<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">onSetMod: &#123;</span><br><span class="line">  js: &#123;</span><br><span class="line">    inited: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// сохраняем ссылку на элемент</span></span><br><span class="line">      <span class="keyword">this</span>.control = <span class="keyword">this</span>.findElem(<span class="string">'control'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// сохраняем идентификатор элемента control</span></span><br><span class="line">      <span class="keyword">this</span>._id = <span class="keyword">this</span>.control.attr(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// слушаем изменение значения слайдера</span></span><br><span class="line">      <span class="keyword">this</span>.bindTo(<span class="string">'control'</span>, <span class="string">'change'</span>, <span class="keyword">this</span>._onChange, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// слушаем клик на слайдере</span></span><br><span class="line">      <span class="keyword">this</span>.bindTo(<span class="string">'control'</span>, <span class="string">'mousedown'</span>, <span class="keyword">this</span>._onMouseDown, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// слушаем когда пользователь закончил работать со слайдером</span></span><br><span class="line">      <span class="keyword">this</span>.bindTo(<span class="string">'control'</span>, <span class="string">'mouseup'</span>, <span class="keyword">this</span>._onMouseUp, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// сразу же вызываем событие изменения слайдера.</span></span><br><span class="line">      <span class="comment">// Чтобы при инициализации все необходимые стили</span></span><br><span class="line">      <span class="comment">// установились к нашему блоку.</span></span><br><span class="line">      <span class="keyword">this</span>.control.trigger(<span class="string">'change'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Опишу сразу метод создания стилей для заливки выбранного диапазона, т.к. он используется в методах-слушателях (он также описывается в области для методов экземпляра блока):<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// список вендорных псевдоэлементов</span></span><br><span class="line">_trackSelectors: [<span class="string">'::-webkit-slider-runnable-track'</span>, <span class="string">'::-moz-range-track'</span>],</span><br><span class="line"></span><br><span class="line">_updateFillTrack: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// максимальное значение слайдера</span></span><br><span class="line">  <span class="keyword">var</span> max = <span class="built_in">Number</span>(<span class="keyword">this</span>.control.attr(<span class="string">'max'</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// минимальное значение слайдера</span></span><br><span class="line">  <span class="keyword">var</span> min = <span class="built_in">Number</span>(<span class="keyword">this</span>.control.attr(<span class="string">'min'</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// на основе выше полученных данных</span></span><br><span class="line">  <span class="comment">// вычисляем значение выбранного диапазона в процентах</span></span><br><span class="line">  <span class="comment">// и формируем строку с новым значением свойства background-size.</span></span><br><span class="line">  <span class="keyword">var</span> property = <span class="string">'background-size:'</span> + <span class="number">100</span> * (<span class="keyword">this</span>.getVal() - min) / (max - min) + <span class="string">'% 100%, 100% 100%'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// переменная для хранения правила для определенного псевдоэлемента</span></span><br><span class="line">  <span class="keyword">var</span> rule = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//переменная для хранения всех стилей для блока</span></span><br><span class="line">  <span class="keyword">var</span> rules = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// пробегаемся по всем псевдоэлементам и формируем css блок</span></span><br><span class="line">  <span class="keyword">this</span>._trackSelectors.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(value, index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> selector = <span class="string">'#'</span> + <span class="keyword">this</span>._id + value;</span><br><span class="line">    rule += selector + <span class="string">'&#123;'</span> + property + <span class="string">'&#125;'</span>;</span><br><span class="line">  &#125;, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// сохраняем стиль каждого бока в статическую переменную</span></span><br><span class="line">  <span class="keyword">this</span>.__self.cssRules[<span class="keyword">this</span>._id] = rule;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// пробегаемся по всем стилям всех блоков и формируем строку для тега style.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> <span class="keyword">this</span>.__self.cssRules) rules += <span class="keyword">this</span>.__self.cssRules[index];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// обновляем стили в теге style</span></span><br><span class="line">  $(<span class="string">'style.range-styles'</span>).text(rules);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Код конечно не идеален, но я планирую рефакторинг этой части + при подведении итогов конкурса пообещали предоставить ревью проекта.</p>
<p>Теперь можно разобрать код слушателей событий:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// основной слушатель изменения значения слайдера</span></span><br><span class="line">_onChange: <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// проверка если элемент со значением слайдера имеет тип tooltip,</span></span><br><span class="line">  <span class="comment">// то необходимо изменить его позицию</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.hasMod(<span class="keyword">this</span>.elem(<span class="string">'value'</span>), <span class="string">'type'</span>, <span class="string">'tooltip'</span>)) <span class="keyword">this</span>._updateTooltipPosition(event.originalEvent);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// изменяет содержимое элемента со значение слайдера</span></span><br><span class="line">  <span class="comment">// на обновленное значение</span></span><br><span class="line">  <span class="keyword">this</span>.findElem(<span class="string">'value'</span>).text(<span class="keyword">this</span>.getVal());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// обновляем заливку выбранного диапазона</span></span><br><span class="line">  <span class="keyword">this</span>._updateFillTrack();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// также необходимо вызвать собственное событие,</span></span><br><span class="line">  <span class="comment">// чтобы другие блоки могли его слушать</span></span><br><span class="line">  <span class="keyword">this</span>.emit(<span class="string">'change'</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// событие, которые вызвается при нажатии на слайдер</span></span><br><span class="line">_onMouseDown: <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// необходимо показать элемент со значением слайдера, если он является тултипом</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.hasMod(<span class="keyword">this</span>.elem(<span class="string">'value'</span>), <span class="string">'type'</span>, <span class="string">'tooltip'</span>)) <span class="keyword">this</span>.elem(<span class="string">'value'</span>).show();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// подписываемся на событие движения мышкой на слайдере</span></span><br><span class="line">  <span class="keyword">this</span>.bindTo(<span class="string">'control'</span>, <span class="string">'mousemove'</span>, <span class="keyword">this</span>._onChange, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// при нажатии также необходимо изменить значение слайдера</span></span><br><span class="line">  <span class="keyword">this</span>._onChange(event);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// событие при окончании работы со сладйером</span></span><br><span class="line"><span class="comment">// (когда пользователь отпускает левую кнопку мыши)</span></span><br><span class="line">_onMouseUp: <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//  скрываем элемент со значением слайдера, если он является тултипом</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.hasMod(<span class="keyword">this</span>.elem(<span class="string">'value'</span>), <span class="string">'type'</span>, <span class="string">'tooltip'</span>)) <span class="keyword">this</span>.elem(<span class="string">'value'</span>).hide();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// отписываемся на событие движения мышки по слайдеру</span></span><br><span class="line">  <span class="keyword">this</span>.unbindFrom(<span class="string">'control'</span>, <span class="string">'mousemove'</span>, <span class="keyword">this</span>._onChange);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Остальная часть javascript кода не очень интересна. Полный листинг вы можете посмотреть по <a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/range.js" target="_blank" rel="external">этой</a> ссылке.</p>
<h2 id="Шаблонизация">Шаблонизация</h2><p>Самым сложным в разработке для меня оказалось понимание шаблонизатора <strong>BEMHTML</strong>. Некоторые моменты до сих пор остаются для меня не понятными, но думаю это дело времени и практики. В BEMHTML для описания шаблонов используется декларативный подход, что несколько ломает мозг))) Если упростить описание, то это что-то типа CSS для HTML (не помню где вычитал это сравнение). Суть в том, что мы пишем условия, при выполнении которых возвращается определенная BEMJSON структура блока. Документация по BEMHTML находится по этой <a href="https://ru.bem.info/technology/bemhtml/v2/intro/" target="_blank" rel="external">ссылке</a>. Сейчас я постараюсь описать свою логику составления шаблонов для слайдера.</p>
<p>Зачем вообще нужны шаблоны для блоков? Представьте, что мы разрабатываем блок с очень сложной структурой, где есть разные варианты вложенности элементов. Программисту, использующему наш  блок, не очень хочется описывать всю эту структуру в своем BEMJSON дереве. Было бы здорово написать так:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  block: <span class="string">'block-name'</span>,</span><br><span class="line">  param1: <span class="string">'value1'</span>,</span><br><span class="line">  param2: <span class="string">'value2'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>А это все развернулось бы в нужный для блока BEMJSON объект. Вот и ответ на вопрос “Зачем нужны шаблоны для блоков?”</p>
<p>Напомню структуру нашего блока:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">range</span></span><br><span class="line">  __title <span class="comment">// необязательный элемент</span></span><br><span class="line">  __box</span><br><span class="line">    __control</span><br><span class="line">    __value <span class="comment">// необязательный элемент</span></span><br></pre></td></tr></table></figure>
<p>Помимо структуры блока имеются еще и различные атрибуты:</p>
<ul>
<li>id - уникальный идентификатор блока;</li>
<li>max - максимальное значение слайдера;</li>
<li>min - минимальное значение слайдера;</li>
<li>value - первоначальное значение слайера.</li>
</ul>
<p>Учитывая вышесказанное, определим BEMJSON структуру блока для удобного использования в разных проектах.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// собственно сам блок</span></span><br><span class="line">  block: <span class="string">'range'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// его тема</span></span><br><span class="line">  mods: &#123; theme: <span class="string">'islands'</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// заголовок, если его не передать то выполнится шаблон</span></span><br><span class="line">  <span class="comment">// без добавления заголовка</span></span><br><span class="line">  title: <span class="string">'Range 1'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// свойство определяющее тип элемента для отображения</span></span><br><span class="line">  <span class="comment">// текущего значения слайдера. Если его не передать,</span></span><br><span class="line">  <span class="comment">// то выполнится шаблон без вставки этого элемента</span></span><br><span class="line">  displayedValue: &#123; type: <span class="string">'tooltip'</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// атрибут минимального значения слайдера</span></span><br><span class="line">  min: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// атрибут для максимального значения слайдера</span></span><br><span class="line">  max: <span class="number">50</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// атрибут для первоначального значения слайдера</span></span><br><span class="line">  val: <span class="number">40</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Теперь переходим непосредственно к самим шаблонам:</p>
<p>Шаблон <a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/range.bemhtml" target="_blank" rel="external">range.bemhtml</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// говорим шаблону чтобы он отрабатывался, если встречается блок range</span></span><br><span class="line">block(<span class="string">'range'</span>)(</span><br><span class="line">  <span class="comment">// говорим, что блок имеет js реализацию</span></span><br><span class="line">  js()(<span class="literal">true</span>),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// этот кусок выполняется всегда,</span></span><br><span class="line">  <span class="comment">// тут мы просто запоминаем текущий контекст,</span></span><br><span class="line">  <span class="comment">// чтобы можно было к нему обратится во внутренних шаблонах</span></span><br><span class="line">  def()(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    applyNext(&#123;_range: <span class="keyword">this</span>.ctx&#125;);</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// а вот и пошли условия.</span></span><br><span class="line">  <span class="comment">// тут мы проверяем, если пользователь передал в BEMJSON поле title,</span></span><br><span class="line">  <span class="comment">// то вернем структуру для этого элемента</span></span><br><span class="line">  content()(</span><br><span class="line">    match(<span class="keyword">this</span>.ctx.title)</span><br><span class="line">    (</span><br><span class="line">      <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [&#123;</span><br><span class="line">          elem: <span class="string">'title'</span>,</span><br><span class="line">          tag: <span class="string">'label'</span>,</span><br><span class="line">          attrs: &#123;</span><br><span class="line">            <span class="comment">// автоматическая генерация атрибута for</span></span><br><span class="line">            <span class="keyword">for</span>: <span class="keyword">this</span>.generateId()</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// вставляем переданный текст в этот элемент</span></span><br><span class="line">          content: <span class="keyword">this</span>.ctx.title</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// этот кусок выполняется всегда.</span></span><br><span class="line">  <span class="comment">// он генерирует обертку и элемент control,</span></span><br><span class="line">  <span class="comment">// передавая все нужные атрибуты</span></span><br><span class="line">  content()(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        applyNext(),</span><br><span class="line">        &#123;</span><br><span class="line">          elem: <span class="string">'box'</span>,</span><br><span class="line">          content: &#123;</span><br><span class="line">            elem: <span class="string">'control'</span>,</span><br><span class="line">            tag: <span class="string">'input'</span>,</span><br><span class="line">            attrs: &#123;</span><br><span class="line">              type: <span class="string">'range'</span>,</span><br><span class="line">              id: <span class="keyword">this</span>.generateId(),</span><br><span class="line">              min: <span class="keyword">this</span>.ctx.min || <span class="number">0</span>,</span><br><span class="line">              max: <span class="keyword">this</span>.ctx.max || <span class="number">100</span>,</span><br><span class="line">              value: <span class="keyword">this</span>.ctx.val</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Ниже представлен код шаблона для элемента <strong>box</strong>. Отдельный шаблон необходим, так как мы имеем в этом элементе необязательный элемент <strong>value</strong>:</p>
<p>Шаблон <a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/__box/range__box.bemhtml" target="_blank" rel="external">range__box.bemhtml</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// шаблон выполнится когда в BEMJSON будет найден элемент **box**</span></span><br><span class="line">block(<span class="string">'range'</span>).elem(<span class="string">'box'</span>)(</span><br><span class="line"></span><br><span class="line">  <span class="comment">// тут мы обращаемся к ранее сохраненному контексту</span></span><br><span class="line">    <span class="comment">// и проверяем было ли определено поле displayedValue</span></span><br><span class="line">  content()</span><br><span class="line">    (match(<span class="keyword">this</span>._range.displayedValue)</span><br><span class="line">    (</span><br><span class="line">      <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">          applyNext(),</span><br><span class="line">          &#123;</span><br><span class="line">            elem: <span class="string">'value'</span>,</span><br><span class="line">            tag: <span class="string">'span'</span>,</span><br><span class="line">            mods: <span class="keyword">this</span>._range.displayedValue</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>По шаблонам все.</p>
<p>Если вы не сталкивались с написанием шаблонов на BEMHTML, то советую для начала почитать <a href="https://ru.bem.info/technology/bemhtml/v2/reference/" target="_blank" rel="external">документацию</a>, так как это не очень простая тема. А если вы уже знаток, то буду рад советам по исправлению моих косяков))</p>
<h2 id="Зависимости">Зависимости</h2><p>Осталось создать последний необходимый файл - <strong>deps.js</strong>, необходимый для описания зависимостей блока (какие элементы и модификаторы ему нужны для нормальной работы). Вот содержимое этого файла:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(&#123;</span><br><span class="line">  <span class="comment">// т.к. наш блок имеет js реализацию,</span></span><br><span class="line">  <span class="comment">// то прописываем зависимость от элемента dom блока i-bem</span></span><br><span class="line">  mustDeps : &#123; block : <span class="string">'i-bem'</span>, elem : <span class="string">'dom'</span> &#125;,</span><br><span class="line">  shouldDeps: [</span><br><span class="line"></span><br><span class="line">    <span class="comment">// зависимость от всех необходимых элементов</span></span><br><span class="line">    &#123; elems: [<span class="string">'box'</span>, <span class="string">'control'</span>, <span class="string">'title'</span>, <span class="string">'value'</span>] &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// зависимость от модификатора type_static элемента value</span></span><br><span class="line">    &#123; elem: <span class="string">'value'</span>, mods: &#123; <span class="string">'type'</span>: <span class="string">'static'</span>&#125; &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// зависимость от модификатора type_tooltip элемента value</span></span><br><span class="line">    &#123; elem: <span class="string">'value'</span>, mods: &#123; <span class="string">'type'</span>: <span class="string">'tooltip'</span>&#125; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Все, что необходимо для нормальной работы блока написано. Я написал еще <a href="https://github.com/kuflash/bem-range/blob/master/common.blocks/range/range.ru.md" target="_blank" rel="external">документацию</a>, где описал все нюансы использования блока, а также создал <a href="http://bem-range-demo.bitballoon.com/" target="_blank" rel="external">демо-страницу</a>.</p>
<h2 id="Заключение">Заключение</h2><p>В итоге мы получили рабочий БЭМ-блок, который можно использовать в своих проектах. Я продолжу его улучшать и исправлять найденные баги. Необходимо будет добавить возможность создавать вертикальные слайдеры.</p>
<h2 id="Полезные_ссылки">Полезные ссылки</h2><ol>
<li><a href="https://ru.bem.info" target="_blank" rel="external">Официальный сайт БЭМ-методологии</a> - различная документация по методологии, статьи, руководства, а также замечательный форум, где вам обязательно помогут</li>
<li><a href="https://github.com/kuflash/bem-range/" target="_blank" rel="external">Репозиторий проекта</a></li>
<li><a href="https://github.com/kuflash/bem-range/wiki/Documentation" target="_blank" rel="external">Документайия блока</a></li>
<li><a href="http://bem-range-demo.bitballoon.com/" target="_blank" rel="external">Демо-страница</a></li>
</ol>
<p><em><strong>P.S.</strong> Не знаю много ли людей дочитают эту статью до конца. В любом случае всем спасибо за уделенное внимание. Это была моя первая статья. Уверен, что есть огрехи. Буду рад услышать конструктивные замечания и постараюсь все исправить.</em></p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Игорь Уваров</h4>
    <p>Разработчик интерфейсов в компании Teoxoft</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://www.kuflash.ru/2015/03/15/bem-range/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.kuflash.ru/2015/03/15/bem-range/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.kuflash.ru/2015/03/15/bem-range/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <span class="page-number">•</span>
    
</nav>
  <div id="comment" class="comments-area">
  <h1 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</div>
</main>


  
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright"><a href="/">~kuflash~</a></section>
     <section class="poweredby">Опубликовано с помощью <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>



<script type="text/javascript">
    var disqus_shortname = 'kuflashru';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
